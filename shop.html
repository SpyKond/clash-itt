<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clash Of IT - –ú–∞–≥–∞–∑–∏–Ω</title>
    <style>
        * { box-sizing: border-box; } /* –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—ã–ª–µ—Ç–∞ –∑–∞ –∫—Ä–∞—è */
        body { background: #050505; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; }
        
        .header { width: 100%; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        #main-content { width: 100%; display: flex; flex-direction: column; align-items: center; padding: 10px; overflow-y: auto; height: 100vh; padding-bottom: 100px; }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –ø–∞–∫–æ–≤ */
        .pack-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(105px, 120px)); 
            gap: 10px; 
            width: 100%; 
            justify-content: center; 
            perspective: 1000px; 
            margin-top: 15px; 
        }
        
        .pack-card { width: 110px; height: 160px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
        .pack-card.flipped { transform: rotateY(180deg); }
        
        .pack-front, .pack-back { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            border-radius: 12px; border: 2px solid #333; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; background: #111; 
        }
        .pack-back { transform: rotateY(180deg); background: #1a1a1a; font-size: 9px; padding: 5px; text-align: center; }
        
        .info-btn { position: absolute; top: 5px; right: 5px; width: 18px; height: 18px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; border: 1px solid #444; z-index: 10; }

        /* –¶–≤–µ—Ç–∞ –ø–∞–∫–æ–≤ */
        .pack-card.common .pack-front, .pack-opening.common { border-color: #888; box-shadow: 0 0 10px rgba(255,255,255,0.1); }
        .pack-card.epic .pack-front, .pack-opening.epic { border-color: #9C27B0; box-shadow: 0 0 15px rgba(156,39,176,0.3); color: #e1bee7; }
        .pack-card.legend .pack-front, .pack-opening.legend { border-color: gold; box-shadow: 0 0 20px rgba(255,215,0,0.3); color: gold; }
        
        #opening-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 2000; background: rgba(0,0,0,0.95); flex-direction: column; }
        .flipper { position: relative; width: 220px; height: 310px; transform-style: preserve-3d; transition: transform 0.6s; }
        .pack-opening, .card-result { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; border: 4px solid #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #111; }
        .card-result { transform: rotateY(180deg); background: #222; }

        .shaking { animation: shake 0.1s infinite, glow-pulse 0.4s infinite alternate; }
        @keyframes shake { 0%{transform:translate(2px,1px)} 50%{transform:translate(-2px,-1px)} 100%{transform:translate(0)} }
        @keyframes glow-pulse { from { box-shadow: 0 0 20px var(--glow-color); } to { box-shadow: 0 0 80px var(--glow-color); } }

        .promo-box { margin-top: 25px; background: #111; padding: 15px; border-radius: 15px; border: 1px solid #333; width: 90%; max-width: 280px; text-align: center; }
        .promo-box input { background: #000; border: 1px solid #444; color: white; padding: 10px; border-radius: 8px; width: 100%; text-align: center; text-transform: uppercase; margin-bottom: 10px; }
        .promo-box button { background: #00fbff; color: black; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; }
        
        .btn-claim { background: #2196F3; color: white; padding: 15px 40px; border: none; border-radius: 12px; margin-top: 30px; font-weight: bold; display: none; cursor: pointer; }
        
        .starter-btn { width: 90%; max-width: 300px; padding: 12px; border: 2px dashed #00fbff; background: rgba(0,251,255,0.05); color: #00fbff; cursor: pointer; border-radius: 10px; font-weight: bold; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="main-content">
    <div class="header">
        <button onclick="window.location.href='index.html'" style="background:#444; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">–ù–ê–ó–ê–î</button>
        <div style="color:gold; font-size: 20px; font-weight: bold;">üí∞ <span id="coins-val">0</span></div>
    </div>
    
    <h1 style="text-align:center; color:#00fbff; margin: 5px 0;">–ú–ê–ì–ê–ó–ò–ù</h1>
    
    <div id="starter-section"></div>
    
    <div class="pack-container">
        <div class="pack-card common" id="p-common">
            <div class="pack-front" onclick="buyPack('common', 150)">
                <div class="info-btn" onclick="toggleInfo('p-common')">i</div>
                <span style="font-size:40px">üì¶</span><b>–û–ë–´–ß–ù–´–ô</b><p>150 C</p>
            </div>
            <div class="pack-back" onclick="toggleInfo('p-common')"><b>–®–ê–ù–°–´:</b><br>–û–±—ã—á: 85%<br>–†–µ–¥: 14%<br>–≠–ø–∏–∫: 1%</div>
        </div>

        <div class="pack-card epic" id="p-epic">
            <div class="pack-front" onclick="buyPack('epic', 300)">
                <div class="info-btn" onclick="toggleInfo('p-epic')">i</div>
                <span style="font-size:40px">üíé</span><b>–≠–ü–ò–ß–ï–°–ö–ò–ô</b><p>300 C</p>
            </div>
            <div class="pack-back" onclick="toggleInfo('p-epic')"><b>–®–ê–ù–°–´:</b><br>–†–µ–¥: 70%<br>–≠–ø–∏–∫: 28%<br>–ú–∏—Ñ: 2%</div>
        </div>

        <div class="pack-card legend" id="p-legend">
            <div class="pack-front" onclick="buyPack('legend', 500)">
                <div class="info-btn" onclick="toggleInfo('p-legend')">i</div>
                <span style="font-size:40px">üëë</span><b>–ö–û–†–û–õ–ï–í–°–ö–ò–ô</b><p>500 C</p>
            </div>
            <div class="pack-back" onclick="toggleInfo('p-legend')"><b>–®–ê–ù–°–´:</b><br>–†–µ–¥: 20%<br>–≠–ø–∏–∫: 70%<br>–ú–∏—Ñ: 10%</div>
        </div>
    </div>

    <div class="promo-box">
        <input type="text" id="promo-input" placeholder="–ü–†–û–ú–û–ö–û–î">
        <button onclick="activatePromo()">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨</button>
    </div>
</div>

<div id="opening-overlay">
    <div class="flipper" id="flipper" onclick="handlePackClick()">
        <div id="pack-visual" class="pack-opening">
            <h2 id="tap-hint">–ù–ê–ñ–ú–ò!</h2>
            <div id="pack-icon" style="font-size: 70px;">üì¶</div>
        </div>
        <div id="card-result" class="card-result">
            <div id="c-rat" style="position:absolute; top:15px; left:15px; font-size:28px; font-weight:bold;"></div>
            <h2 id="c-name" style="font-size: 18px;">–ò–ú–Ø</h2>
            <p id="c-class" style="color:#00fbff; font-weight:bold; font-size: 12px;"></p>
            <p id="c-rarity" style="margin-top:10px; font-size:12px; text-transform:uppercase;"></p>
        </div>
    </div>
    <button id="claim-btn" class="btn-claim" onclick="location.reload()">–í –ö–û–õ–õ–ï–ö–¶–ò–Æ</button>
</div>

<script>
    const MY_CHARS = [
        {n:"–î–∏–º–∞—à", c:"–±–ª–∏–∂–Ω–∏–∫", r:"—Ä–µ–¥–∫–∏–π"}, {n:"–ë–µ–∫—Å—É–ª—Ç–∞–Ω", c:"–ª–µ—Ç—É–Ω", r:"—Ä–µ–¥–∫–∏–π"},
        {n:"–ú–∞–Ω—Å—É—Ä", c:"–º–∏–Ω–∏ –∞—Ä–º–∏—è", r:"–æ–±—ã—á–Ω—ã–π"}, {n:"–ë–µ–∫–±–æ–ª–∞—Ç", c:"—Ç–∞–Ω–∫", r:"—ç–ø–∏—á–µ—Å–∫–∏–π"},
        {n:"–î–∞—Å—Ç–µ–Ω", c:"—Ç—É—Ä–µ–ª—å", r:"—ç–ø–∏—á–µ—Å–∫–∏–π"}, {n:"–ë–µ–π–±–∞—Ä—ã—Å", c:"—Ç–∞–Ω–∫", r:"—Ä–µ–¥–∫–∏–π"},
        {n:"–ë–∏–±–∞—Ä—ã—Å", c:"–±–ª–∏–∂–Ω–∏–∫", r:"—Ä–µ–¥–∫–∏–π"}, {n:"–ê–∫—ã–ª–∂–∞–Ω", c:"–º–µ–¥–∏–∫", r:"–æ–±—ã—á–Ω—ã–π"},
        {n:"–ù—É—Ä–∞—Å—ã–ª", c:"—Ç—É—Ä–µ–ª—å", r:"–æ–±—ã—á–Ω—ã–π"}, {n:"–ó—É. –ï—Ä–∞—Å—ã–ª", c:"–ª–µ—Ç—É–Ω", r:"–æ–±—ã—á–Ω—ã–π"},
        {n:"–ê–±–¥—É—Ä–∞—Ö–º–∞–Ω", c:"—Ä–æ–π", r:"—Ä–µ–¥–∫–∏–π"}, {n:"–ë–µ–∫–∑–∞—Ç", c:"–±–ª–∏–∂–Ω–∏–∫", r:"—ç–ø–∏—á–µ—Å–∫–∏–π"},
        {n:"–ê—Å–∫–∞—Ä", c:"–º–µ–¥–∏–∫", r:"—ç–ø–∏—á–µ—Å–∫–∏–π"}, {n:"–ê—Ä–∞—Ñ–∞—Ç", c:"–ª—É—á–Ω–∏–∫", r:"–º–∏—Ñ–∏—á–µ—Å–∫–∏–π"},
        {n:"–ó–∞–Ω–≥–∞—Ä", c:"–ª—É—á–Ω–∏–∫", r:"—ç–ø–∏—á–µ—Å–∫–∏–π"}, {n:"–ù—É—Ä–∞–ª–∏–º", c:"—Ç–∞–Ω–∫", r:"—Ä–µ–¥–∫–∏–π"},
        {n:"–ú–∞–∫—Å–∞—Ç", c:"–ª—É—á–Ω–∏–∫", r:"–æ–±—ã—á–Ω—ã–π"}, {n:"–ë–µ—Ä–∏–∫", c:"–º–µ–¥–∏–∫", r:"–º–∏—Ñ–∏—á–µ—Å–∫–∏–π"},
        {n:"–î–∏–Ω–º—É—Ö–∞–º–¥", c:"–ª–µ—Ç—É–Ω", r:"—Ä–µ–¥–∫–∏–π"}, {n:"–ó–∞. –ï—Ä–∞—Å—ã–ª", c:"—Ä–æ–π", r:"–æ–±—ã—á–Ω—ã–π"},
        {n:"–ë–µ–∫–Ω—É—Ä", c:"–º–∏–Ω–∏ –∞—Ä–º–∏—è", r:"—ç–ø–∏—á–µ—Å–∫–∏–π"}
    ];

    const DB_URL = "https://clashofit-default-rtdb.asia-southeast1.firebasedatabase.app/";
    let coins = parseInt(localStorage.getItem('it_coins') || 500);
    document.getElementById('coins-val').innerText = coins;
    let currentCard = null;
    let isOpening = false;

    window.onload = () => { renderStarter(); };

    function toggleInfo(id) { event.stopPropagation(); document.getElementById(id).classList.toggle('flipped'); }

    // –ï–î–ò–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –®–ê–ù–°–û–í
    function getRarityByType(type) {
        let rand = Math.random();
        if (type === 'legend') {
            if (rand < 0.10) return '–º–∏—Ñ–∏—á–µ—Å–∫–∏–π';
            if (rand < 0.80) return '—ç–ø–∏—á–µ—Å–∫–∏–π';
            return '—Ä–µ–¥–∫–∏–π';
        } else if (type === 'epic') {
            if (rand < 0.02) return '–º–∏—Ñ–∏—á–µ—Å–∫–∏–π';
            if (rand < 0.30) return '—ç–ø–∏—á–µ—Å–∫–∏–π';
            return '—Ä–µ–¥–∫–∏–π';
        } else {
            if (rand < 0.01) return '—ç–ø–∏—á–µ—Å–∫–∏–π';
            if (rand < 0.15) return '—Ä–µ–¥–∫–∏–π';
            return '–æ–±—ã—á–Ω—ã–π';
        }
    }

    function generateCard(rarity) {
        let possible = MY_CHARS.filter(c => c.r === rarity);
        let char = possible.length > 0 ? possible[Math.floor(Math.random()*possible.length)] : MY_CHARS[0];
        let rating = rarity === '–º–∏—Ñ–∏—á–µ—Å–∫–∏–π' ? 98 : (rarity === '—ç–ø–∏—á–µ—Å–∫–∏–π' ? 92 : (rarity === '—Ä–µ–¥–∫–∏–π' ? 84 : 70));
        return { name: char.n, class: char.c, rarity: rarity, rating: rating, id: Date.now() + Math.random() };
    }

    function buyPack(type, price) {
        if(coins < price) return alert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!");
        coins -= price;
        localStorage.setItem('it_coins', coins);
        document.getElementById('coins-val').innerText = coins;
        currentCard = generateCard(getRarityByType(type));
        setupOverlay(type);
    }

    function setupOverlay(type) {
        isOpening = false;
        document.getElementById('flipper').style.transform = "rotateY(0deg)";
        let visual = document.getElementById('pack-visual');
        visual.className = "pack-opening " + type;
        document.getElementById('pack-icon').innerText = type === 'legend' ? "üëë" : (type === 'epic' ? "üíé" : "üì¶");
        
        let glowColor = "#ffffff"; 
        if (currentCard.rarity === '–º–∏—Ñ–∏—á–µ—Å–∫–∏–π') glowColor = "#ff0000";
        else if (currentCard.rarity === '—ç–ø–∏—á–µ—Å–∫–∏–π') glowColor = "#bf00ff";
        else if (currentCard.rarity === '—Ä–µ–¥–∫–∏–π') glowColor = "#00fbff"; 

        visual.style.setProperty('--glow-color', glowColor);
        document.getElementById('card-result').style.borderColor = glowColor;
        document.getElementById('opening-overlay').style.display = 'flex';
        document.getElementById('claim-btn').style.display = 'none';
        document.getElementById('tap-hint').style.display = 'block';
    }

    function handlePackClick() {
        if(isOpening || !currentCard) return;
        isOpening = true;
        document.getElementById('tap-hint').style.display = 'none';
        document.getElementById('pack-visual').classList.add('shaking');
        
        setTimeout(() => {
            document.getElementById('pack-visual').classList.remove('shaking');
            document.getElementById('c-name').innerText = currentCard.name;
            document.getElementById('c-class').innerText = currentCard.class.toUpperCase();
            document.getElementById('c-rat').innerText = currentCard.rating;
            document.getElementById('c-rarity').innerText = currentCard.rarity;
            
            let rColor = (currentCard.rarity === '–º–∏—Ñ–∏—á–µ—Å–∫–∏–π') ? "#ff0000" : (currentCard.rarity === '—ç–ø–∏—á–µ—Å–∫–∏–π' ? "#bf00ff" : "#fff");
            document.getElementById('c-rarity').style.color = rColor;
            document.getElementById('flipper').style.transform = "rotateY(180deg)";
            
            let col = JSON.parse(localStorage.getItem('my_collection') || "[]");
            col.push(currentCard);
            localStorage.setItem('my_collection', JSON.stringify(col));
            document.getElementById('claim-btn').style.display = 'block';
        }, 1200);
    }

    async function activatePromo() {
        const val = document.getElementById('promo-input').value.trim().toUpperCase();
        if(!val) return;

        let used = JSON.parse(localStorage.getItem('used_promos') || "[]");
        if(used.includes(val)) return alert("–ö–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!");

        try {
            let res = await fetch(`${DB_URL}promos/${val}.json`);
            let p = await res.json();
            if(p && Date.now() < p.expire) {
                used.push(val);
                localStorage.setItem('used_promos', JSON.stringify(used));
                if(p.coins) {
                    coins += p.coins;
                    localStorage.setItem('it_coins', coins);
                    document.getElementById('coins-val').innerText = coins;
                }
                if(p.pack && p.pack !== 'none') {
                    currentCard = generateCard(getRarityByType(p.pack));
                    setupOverlay(p.pack);
                } else { alert("–£—Å–ø–µ—à–Ω–æ!"); }
            } else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!");
        } catch(e) { alert("–û—à–∏–±–∫–∞!"); }
    }

    function renderStarter() {
        let col = JSON.parse(localStorage.getItem('my_collection') || "[]");
        if(col.length === 0) {
            document.getElementById('starter-section').innerHTML = `<button class="starter-btn" onclick="startFreePack()">–û–¢–ö–†–´–¢–¨ –ù–ê–ß–ê–õ–¨–ù–´–ô –ù–ê–ë–û–† (8 –ö–ê–†–¢)</button>`;
        }
    }

    function startFreePack() {
        let set = []; for(let i=0; i<8; i++) set.push(generateCard('–æ–±—ã—á–Ω—ã–π'));
        localStorage.setItem('my_collection', JSON.stringify(set));
        location.reload();
    }
</script>
</body>
</html>